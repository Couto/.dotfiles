#!/usr/bin/env zsh

BIN="$(which brew)"

TAPS=(
  thoughtbot/formulae
  caskroom/versions
  caskroom/fonts
);

PACKAGES=(
  coreutils
  dnsmasq --with-dnssec
  dnscrypt-proxy
  tree
  nvm
  shellcheck
  rbenv
  rcm
  pyenv
  tmux
  z
  zsh
);

APPS=(
  atom
  iterm2
  slack-beta
  macpass
  vagrant
  virtualbox
  the-unarchiver
  firefox
  google-chrome
  google-chrome-canary
);

FONTS=(
  font-fira-mono
  font-dejavu-sans-mono-for-powerline
);

setup_homebrew() {
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

setup_homebrewcask() {
  ${BIN} install caskroom/cask/brew-cask
  for i in "${TAPS[@]}" do:
    ${BIN} tap ${i}
  done
}

install_packages() {
  local pkgs=${1}
  local modifier="${2}"

  for i in "${pksgs[@]}" do:
    ${BIN} ${modifier} install ${i}
  done
}

main () {
  if [[ -n ${BIN} ]]; then
    setup_homebrew;
    setup_homebrewcask;
    install_packages ${PACKAGES};
    install_packages ${APPS} "cask";
    install_packages ${FONTS} "cask";
  fi
}

main;
